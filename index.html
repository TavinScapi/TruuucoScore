<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcador de Truco</title>

    <!-- Meta Tags e Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-title" content="TS">

    <!-- Ícones -->
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg">
    <link rel="shortcut icon" href="/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">

    <!-- Estilos -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="screen-container">
        <!-- Cabeçalho -->
        <header>
            <h1>Vamos jogar</h1>
            <p>Configure do seu jeito e comece!</p>
            <img src="/image/LogoTruuucoScore.png" alt="Carta de Truco" class="header-card">
        </header>

        <!-- Conteúdo Principal -->
        <main>
            <!-- Seção de Configurações -->
            <section class="settings-section">
                <div class="section-header">
                    <h2>Definições do Jogo</h2>
                    <i class="bi bi-pencil-fill" id="edit-settings"></i>
                </div>

                <div class="settings-card-list">
                    <div class="setting-item" data-setting="Tipo de Truco">
                        <div class="item-icon-bg">
                            <i class="bi bi-calendar-event-fill"></i>
                        </div>
                        <div class="item-text">
                            <h3>Tipo de Truco</h3>
                            <p>Paulista</p>
                        </div>
                    </div>

                    <div class="setting-item" data-setting="Pontuação Máxima">
                        <div class="item-icon-bg">
                            <i class="bi bi-clipboard-data-fill"></i>
                        </div>
                        <div class="item-text">
                            <h3>Pontuação Máxima</h3>
                            <p>Atual: 12</p>
                        </div>
                    </div>

                    <div class="setting-item" data-setting="Número de Partidas">
                        <div class="item-icon-bg">
                            <i class="bi bi-trophy-fill"></i>
                        </div>
                        <div class="item-text">
                            <h3>Número de Partidas</h3>
                            <p>Melhor de 3</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção de Equipes -->
            <section class="teams-section">
                <div class="section-header">
                    <h2>Equipes</h2>
                </div>

                <div class="team-cards">
                    <div class="team-card">
                        <div class="team-name">
                            <i class="bi bi-flag-fill"></i>
                            <span id="team-name-nos">Nós</span>
                        </div>
                        <i class="bi bi-pencil-fill edit-team" data-team="nos"></i>
                    </div>

                    <div class="team-card">
                        <div class="team-name">
                            <i class="bi bi-flag-fill"></i>
                            <span id="team-name-eles">Eles</span>
                        </div>
                        <i class="bi bi-pencil-fill edit-team" data-team="eles"></i>
                    </div>
                </div>
            </section>

            <!-- Botão de Iniciar -->
            <div class="start-button-container">
                <button class="start-button" id="start-game">Iniciar partida</button>
            </div>
        </main>
    </div>

    <!-- Modal de Edição de Nomes -->
    <div class="modal-overlay" id="editModal">
        <div class="edit-modal">
            <div class="modal-header">
                <h2 id="modalTitle">Editar Nome da Equipe</h2>
                <button class="close-modal" id="closeModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <form id="teamNameForm">
                <div class="form-group">
                    <label for="teamNameInput">Nome da Equipe</label>
                    <input type="text" id="teamNameInput" class="form-input" placeholder="Digite o nome da equipe"
                        maxlength="20" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelEdit">Cancelar</button>
                    <button type="submit" class="btn btn-save">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Banner PWA -->
    <div id="pwaBanner" class="pwa-banner" style="display: none;">
        <div class="content">
            <div class="pwa-content">
                Instale o TruuucoScore para acessar como um app!
            </div>
            <div class="list">
                <button class="muted">Recusar</button>
                <button id="installBtn" class="pwa-btn">Instalar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Sistema de Edição de Nomes
        class TeamNameEditor {
            constructor() {
                this.currentTeam = null;
                this.modal = document.getElementById('editModal');
                this.form = document.getElementById('teamNameForm');
                this.teamNameInput = document.getElementById('teamNameInput');
                this.modalTitle = document.getElementById('modalTitle');

                this.initEventListeners();
            }

            initEventListeners() {
                // Botões de edição das equipes
                document.querySelectorAll('.edit-team').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.openEditModal(button.dataset.team);
                    });
                });

                // Fechar modal
                document.getElementById('closeModal').addEventListener('click', () => this.closeModal());
                document.getElementById('cancelEdit').addEventListener('click', () => this.closeModal());

                // Submeter formulário
                this.form.addEventListener('submit', (e) => this.saveTeamName(e));

                // Fechar modal clicando fora
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.closeModal();
                    }
                });

                // Fechar com ESC
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.modal.classList.contains('active')) {
                        this.closeModal();
                    }
                });
            }

            openEditModal(teamId) {
                this.currentTeam = teamId;
                const teamElement = document.getElementById(`team-name-${teamId}`);
                const currentName = teamElement.textContent;

                this.teamNameInput.value = currentName;
                this.modalTitle.textContent = `Editar ${this.getTeamDisplayName(teamId)}`;
                this.modal.classList.add('active');

                // Focar no input
                setTimeout(() => {
                    this.teamNameInput.focus();
                    this.teamNameInput.select();
                }, 300);
            }

            closeModal() {
                this.modal.classList.remove('active');
                this.currentTeam = null;
                this.form.reset();
            }

            saveTeamName(e) {
                e.preventDefault();

                const newName = this.teamNameInput.value.trim();

                if (!newName) {
                    this.showError('Por favor, digite um nome para a equipe.');
                    return;
                }

                if (newName.length > 20) {
                    this.showError('O nome deve ter no máximo 20 caracteres.');
                    return;
                }

                const teamElement = document.getElementById(`team-name-${this.currentTeam}`);
                teamElement.textContent = newName;

                // Salvar no localStorage para sincronizar entre páginas
                this.saveToLocalStorage(this.currentTeam, newName);

                this.closeModal();
                this.showSuccess('Nome salvo com sucesso!');
            }

            getTeamDisplayName(teamId) {
                const names = {
                    'nos': 'Nossa Equipe',
                    'eles': 'Equipe Adversária'
                };
                return names[teamId] || 'Equipe';
            }

            saveToLocalStorage(teamId, name) {
                const teams = JSON.parse(localStorage.getItem('trucoTeams') || '{}');
                teams[teamId] = name;
                localStorage.setItem('trucoTeams', JSON.stringify(teams));
            }

            loadFromLocalStorage() {
                const teams = JSON.parse(localStorage.getItem('trucoTeams') || '{}');

                if (teams.nos) {
                    document.getElementById('team-name-nos').textContent = teams.nos;
                }
                if (teams.eles) {
                    document.getElementById('team-name-eles').textContent = teams.eles;
                }
            }

            showError(message) {
                // Implementação simples de alerta - pode ser melhorada com um toast
                alert(`❌ ${message}`);
            }

            showSuccess(message) {
                // Implementação simples de sucesso - pode ser melhorada com um toast
                console.log(`✅ ${message}`);
            }
        }

        // Inicialização quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', () => {
            // Sistema de edição de nomes
            const teamEditor = new TeamNameEditor();
            teamEditor.loadFromLocalStorage();

            // Botão Iniciar Partida
            const startButton = document.getElementById('start-game');
            startButton.addEventListener('click', () => {
                const originalText = startButton.textContent;
                startButton.textContent = "Carregando...";
                startButton.disabled = true;
                startButton.style.opacity = 0.7;

                // Redirecionar para o marcador após uma breve animação
                setTimeout(() => {
                    window.location.href = 'marcador.html';
                }, 800);
            });

            // Botão de editar configurações
            document.getElementById('edit-settings').addEventListener('click', () => {
                alert("Abrindo menu para editar definições do jogo...");
            });

            // Itens de configuração
            document.querySelectorAll('.setting-item').forEach(item => {
                item.addEventListener('click', () => {
                    const name = item.dataset.setting;
                    alert(`Abrindo opções para: ${name}`);
                });
            });
        });

        // Service Worker e PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('✅ Service Worker registrado:', reg.scope))
                    .catch(err => console.log('❌ Erro ao registrar Service Worker:', err));
            });
        }

        // Instalação do PWA
        let deferredPrompt;
        const pwaBanner = document.getElementById("pwaBanner");
        const installBtn = document.getElementById("installBtn");
        const recusarBtn = document.querySelector(".muted");

        window.addEventListener("beforeinstallprompt", (e) => {
            e.preventDefault();
            deferredPrompt = e;
            pwaBanner.style.display = "flex";
        });

        installBtn.addEventListener("click", async () => {
            if (!deferredPrompt) return;

            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`Usuário escolheu: ${outcome}`);

            deferredPrompt = null;
            pwaBanner.style.display = "none";
        });

        recusarBtn.addEventListener("click", () => {
            pwaBanner.style.display = "none";
            deferredPrompt = null;
            console.log("Usuário recusou instalar o app.");
        });

        window.addEventListener("appinstalled", () => {
            console.log("✅ PWA instalado!");
            pwaBanner.style.display = "none";
        });
    </script>
</body>

</html>