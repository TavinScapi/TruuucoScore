<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruuucoScore</title>

    <!-- Meta Tags e Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-title" content="TS">
    <meta name="google-site-verification" content="PuPg0kNDpVZGjIKGJW4nPzn_JVmw51N7rpTuWLsNiiI" />

    <!-- Ícones -->
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg">
    <link rel="shortcut icon" href="/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">

    <!-- Estilos -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="script.js" defer></script>
</head>

<body>
    <div class="screen-container">
        <header>
            <h1>Vamos jogar</h1>
            <p>Configure do seu jeito e comece!</p>
            <img src="/image/LogoTruuucoScore.png" alt="Carta de Truco" class="header-card"
                style="width: 100px; height: auto;">
        </header>

        <main>
            <section class="settings-section">
                <div class="section-header">
                    <h2>Definições do Jogo</h2>
                </div>

                <div class="settings-card-list">
                    <div class="setting-item" data-setting="Tipo de Truco">
                        <div class="item-icon-bg">
                            <i class="bi bi-calendar-event-fill"></i>
                        </div>
                        <div class="item-text">
                            <h3>Tipo de Truco</h3>
                            <p>Paulista</p>
                        </div>
                    </div>

                    <div class="setting-item" data-setting="Pontuação Máxima">
                        <div class="item-icon-bg">
                            <i class="bi bi-clipboard-data-fill"></i>
                        </div>
                        <div class="item-text">
                            <h3>Pontuação Máxima</h3>
                            <p>Atual: 12</p>
                        </div>
                    </div>

                    <div class="setting-item" data-setting="Número de Partidas">
                        <div class="item-icon-bg">
                            <i class="bi bi-trophy-fill"></i>
                        </div>
                        <div class="item-text">
                            <h3>Número de Partidas</h3>
                            <p>Melhor de 3</p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="teams-section">
                <div class="section-header">
                    <h2>Equipes</h2>
                </div>

                <div class="team-cards">
                    <div class="team-card">
                        <div class="team-name">
                            <div class="item-icon-bg">
                                <i class="bi bi-flag-fill"></i>
                                <span class="team-suit" id="team-suit-nos"></span>
                            </div>
                            <span id="team-name-nos">Nós</span>
                        </div>
                        <i class="bi bi-pencil-fill edit-team" data-team="nos"></i>
                    </div>

                    <div class="team-card">
                        <div class="team-name">
                            <div class="item-icon-bg">
                                <i class="bi bi-flag-fill"></i>
                                <span class="team-suit" id="team-suit-eles"></span>
                            </div>
                            <span id="team-name-eles">Eles</span>
                        </div>
                        <i class="bi bi-pencil-fill edit-team" data-team="eles"></i>
                    </div>
                </div>
            </section>

            <div class="start-button-container">
                <button class="start-button" id="start-game">Iniciar partida</button>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="editModal">
        <div class="edit-modal">
            <div class="modal-header">
                <h2 id="modalTitle">Editar Nome da Equipe</h2>
                <button class="close-modal" id="closeModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <form id="teamNameForm">
                <div class="form-group">
                    <label for="teamNameInput">Nome da Equipe</label>
                    <input type="text" id="teamNameInput" class="form-input" placeholder="Digite o nome da equipe"
                        maxlength="20" required>
                </div>

                <div class="form-group">
                    <label>Escolha o Naipe</label>
                    <div class="suit-options" id="suitOptions">
                        <span class="suit-option" data-suit="♦" data-color="red">
                            <i class="bi bi-suit-diamond-fill"></i>
                        </span>
                        <span class="suit-option" data-suit="♠" data-color="black">
                            <i class="bi bi-suit-spade-fill"></i>
                        </span>
                        <span class="suit-option" data-suit="♥" data-color="red">
                            <i class="bi bi-suit-heart-fill"></i>
                        </span>
                        <span class="suit-option" data-suit="♣" data-color="black">
                            <i class="bi bi-suit-club-fill"></i>
                        </span>
                    </div>
                </div>

                <!-- Nova seção: escolha de skin -->
                <div class="form-group">
                    <label>Escolha a Skin da Carta</label>
                    <div class="skin-options" id="skinOptions">
                        <button type="button" class="skin-option" data-front="/image/padrao/frente.png" data-back="/image/padrao/verso.png" data-default="true">
                            Padrão
                        </button>
                        <button type="button" class="skin-option" data-front="/image/alternativo/frente.png" data-back="/image/alternativo/verso.png">
                            Alternativo
                        </button>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelEdit">Cancelar</button>
                    <button type="submit" class="btn btn-save">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="pwaBanner" class="pwa-banner">
        <div class="content">
            <div class="pwa-content">
                Instale o TruuucoScore para acessar como um app!
            </div>
            <div class="list">
                <button class="muted">Recusar</button>
                <button id="installBtn" class="pwa-btn">Instalar</button>
            </div>
        </div>
    </div>

    <!-- Script local para salvar skin por time (não remove o script.js existente) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editButtons = document.querySelectorAll('.edit-team');
            const editModal = document.getElementById('editModal');
            const skinOptions = document.querySelectorAll('#skinOptions .skin-option');
            const form = document.getElementById('teamNameForm');

            // Quando abrir o modal, guardamos qual time está sendo editado
            editButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const team = btn.dataset.team; // "nos" ou "eles"
                    editModal.dataset.currentTeam = team;

                    // marca skin atual, se houver
                    const raw = localStorage.getItem('teamSkin_' + team);
                    let activeSet = false;
                    if (raw) {
                        try {
                            const skin = JSON.parse(raw);
                            skinOptions.forEach(opt => {
                                if (opt.dataset.front === skin.front && opt.dataset.back === skin.back) {
                                    opt.classList.add('active');
                                    activeSet = true;
                                } else {
                                    opt.classList.remove('active');
                                }
                            });
                        } catch { /* ignore */ }
                    }
                    if (!activeSet) {
                        // marca padrão
                        const def = document.querySelector('#skinOptions .skin-option[data-default="true"]');
                        if (def) {
                            skinOptions.forEach(opt => opt.classList.remove('active'));
                            def.classList.add('active');
                        }
                    }
                });
            });

            // selecionar skin visualmente
            skinOptions.forEach(opt => {
                opt.addEventListener('click', () => {
                    skinOptions.forEach(o => o.classList.remove('active'));
                    opt.classList.add('active');
                });
            });

            // Ao salvar o form, grava a skin escolhida no localStorage por time.
            form.addEventListener('submit', (e) => {
                // mantém comportamento padrão do form (ou converta se seu script.js já tratar)
                const team = editModal.dataset.currentTeam;
                if (team) {
                    const active = document.querySelector('#skinOptions .skin-option.active') || document.querySelector('#skinOptions .skin-option[data-default="true"]');
                    if (active) {
                        const skin = { front: active.dataset.front, back: active.dataset.back };
                        localStorage.setItem('teamSkin_' + team, JSON.stringify(skin));
                    }
                }
                // deixa qualquer outro código de salvamento continuar (evita preventDefault)
            });
        });
    </script>
</body>
</html>