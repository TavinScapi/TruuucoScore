<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruuucoScore</title>

    <!-- Meta Tags e Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-title" content="TS">

    <!-- √çcones -->
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg">
    <link rel="shortcut icon" href="/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">

    <!-- Estilos -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="screen-container">
        <header>
            <h1>Vamos jogar</h1>
            <p>Configure do seu jeito e comece!</p>
            <img src="/image/LogoTruuucoScore.png" alt="Carta de Truco" class="header-card" style="width: 150px; height: auto;">
        </header>

        <main>
            <section class="settings-section">
                <div class="section-header">
                    <h2>Defini√ß√µes do Jogo</h2>
                    <i class="bi bi-pencil-fill" id="edit-settings"></i>
                </div>

                <div class="settings-card-list">
                    <div class="setting-item" data-setting="Tipo de Truco">
                        <div class="item-icon-bg">
                            <i class="bi bi-calendar-event-fill"></i>
                        </div>
                        <div class="item-text">
                            <h3>Tipo de Truco</h3>
                            <p>Paulista</p>
                        </div>
                    </div>

                    <div class="setting-item" data-setting="Pontua√ß√£o M√°xima">
                        <div class="item-icon-bg">
                            <i class="bi bi-clipboard-data-fill"></i>
                        </div>
                        <div class="item-text">
                            <h3>Pontua√ß√£o M√°xima</h3>
                            <p>Atual: 12</p>
                        </div>
                    </div>

                    <div class="setting-item" data-setting="N√∫mero de Partidas">
                        <div class="item-icon-bg">
                            <i class="bi bi-trophy-fill"></i>
                        </div>
                        <div class="item-text">
                            <h3>N√∫mero de Partidas</h3>
                            <p>Melhor de 3</p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="teams-section">
                <div class="section-header">
                    <h2>Equipes</h2>
                </div>

                <div class="team-cards">
                    <div class="team-card">
                        <div class="team-name">
                            <div class="item-icon-bg">
                                <i class="bi bi-flag-fill"></i>
                                <span class="team-suit" id="team-suit-nos"></span>
                            </div>
                            <span id="team-name-nos">N√≥s</span>
                        </div>
                        <i class="bi bi-pencil-fill edit-team" data-team="nos"></i>
                    </div>

                    <div class="team-card">
                        <div class="team-name">
                            <div class="item-icon-bg">
                                <i class="bi bi-flag-fill"></i>
                                <span class="team-suit" id="team-suit-eles"></span>
                            </div>
                            <span id="team-name-eles">Eles</span>
                        </div>
                        <i class="bi bi-pencil-fill edit-team" data-team="eles"></i>
                    </div>
                </div>
            </section>

            <div class="start-button-container">
                <button class="start-button" id="start-game">Iniciar partida</button>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="editModal">
        <div class="edit-modal">
            <div class="modal-header">
                <h2 id="modalTitle">Editar Nome da Equipe</h2>
                <button class="close-modal" id="closeModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <form id="teamNameForm">
                <div class="form-group">
                    <label for="teamNameInput">Nome da Equipe</label>
                    <input type="text" id="teamNameInput" class="form-input" placeholder="Digite o nome da equipe"
                        maxlength="20" required>
                </div>

                <div class="form-group">
                    <label>Escolha o Naipe</label>
                    <div class="suit-options" id="suitOptions">
                        <span class="suit-option" data-suit="‚ô•">‚ô•</span>
                        <span class="suit-option" data-suit="‚ô¶">‚ô¶</span>
                        <span class="suit-option" data-suit="‚ô£">‚ô£</span>
                        <span class="suit-option" data-suit="‚ô†">‚ô†</span>
                        <span class="suit-option" data-suit="üÉè">üÉè</span>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelEdit">Cancelar</button>
                    <button type="submit" class="btn btn-save">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="pwaBanner" class="pwa-banner">
        <div class="content">
            <div class="pwa-content">
                Instale o TruuucoScore para acessar como um app!
            </div>
            <div class="list">
                <button class="muted">Recusar</button>
                <button id="installBtn" class="pwa-btn">Instalar</button>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const overlay = document.getElementById('editModal');
            const editButtons = document.querySelectorAll('.edit-team');
            const teamNameInput = document.getElementById('teamNameInput');
            const modalTitle = document.getElementById('modalTitle');
            const suitOptions = document.getElementById('suitOptions');
            const form = document.getElementById('teamNameForm');
            const closeBtn = document.getElementById('closeModal');
            const cancelBtn = document.getElementById('cancelEdit');
            const startBtn = document.getElementById('start-game');
            let currentTeam = null;

            // Esconde spans de naipe vazios ao carregar
            document.querySelectorAll('.team-cards .item-icon-bg').forEach(bg => {
                const suitSpan = bg.querySelector('.team-suit');
                if (suitSpan && !suitSpan.textContent.trim()) {
                    suitSpan.style.display = 'none';
                }
            });

            function mapSuitToClass(suit) {
                if (suit === '‚ô†') return 'spade';
                if (suit === '‚ô•') return 'heart';
                if (suit === '‚ô¶') return 'diamond';
                if (suit === '‚ô£') return 'club';
                if (suit === 'üÉè') return 'joker';
                return 'diamond';
            }

            function persistTeams() {
                const nosName = document.getElementById('team-name-nos').textContent.trim() || 'N√≥s';
                const elesName = document.getElementById('team-name-eles').textContent.trim() || 'Eles';
                const nosSuit = document.getElementById('team-suit-nos').textContent.trim() || '‚ô¶';
                const elesSuit = document.getElementById('team-suit-eles').textContent.trim() || '‚ô¶';

                const teams = {
                    nos: { name: nosName, suit: nosSuit, suitClass: mapSuitToClass(nosSuit) },
                    eles: { name: elesName, suit: elesSuit, suitClass: mapSuitToClass(elesSuit) }
                };
                localStorage.setItem('trucoTeams', JSON.stringify(teams));
            }

            function openModalFor(team) {
                currentTeam = team;
                const nameSpan = document.getElementById(`team-name-${team}`);
                const suitSpan = document.getElementById(`team-suit-${team}`);
                const currentName = nameSpan ? nameSpan.textContent.trim() : '';
                const currentSuit = suitSpan ? suitSpan.textContent.trim() : '';

                teamNameInput.value = currentName;
                modalTitle.textContent = `Editar Nome da Equipe ‚Äî ${currentName || 'Equipe'}`;

                suitOptions.querySelectorAll('.suit-option').forEach(opt => {
                    opt.classList.toggle('selected', opt.dataset.suit === currentSuit);
                });

                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function closeModal() {
                overlay.classList.remove('active');
                document.body.style.overflow = '';
                currentTeam = null;
            }

            function updateIcon(team, newSuit) {
                const nameSpan = document.getElementById(`team-name-${team}`);
                if (!nameSpan) return;
                const iconBg = nameSpan.closest('.team-name').querySelector('.item-icon-bg');
                const flagIcon = iconBg.querySelector('i');
                const suitSpan = iconBg.querySelector('.team-suit');

                if (newSuit) {
                    if (suitSpan) {
                        suitSpan.textContent = newSuit;
                        suitSpan.style.display = 'inline';
                    }
                    if (flagIcon) flagIcon.style.display = 'none';
                } else {
                    if (suitSpan) {
                        suitSpan.textContent = '';
                        suitSpan.style.display = 'none';
                    }
                    if (flagIcon) flagIcon.style.display = '';
                }
            }

            editButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const team = btn.dataset.team;
                    if (team) openModalFor(team);
                });
            });

            suitOptions.addEventListener('click', (e) => {
                const opt = e.target.closest('.suit-option');
                if (!opt) return;
                suitOptions.querySelectorAll('.suit-option').forEach(o => o.classList.remove('selected'));
                opt.classList.add('selected');
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!currentTeam) return closeModal();

                const newName = teamNameInput.value.trim() || 'Equipe';
                const selected = suitOptions.querySelector('.suit-option.selected');
                const newSuit = selected ? selected.dataset.suit : '';

                const nameSpan = document.getElementById(`team-name-${currentTeam}`);
                const suitSpan = document.getElementById(`team-suit-${currentTeam}`);

                if (nameSpan) nameSpan.textContent = newName;
                if (suitSpan) suitSpan.textContent = newSuit;

                // substitui/oculta √≠cone de bandeira pelo naipe escolhido
                updateIcon(currentTeam, newSuit);

                // persiste imediatamente ao salvar no modal
                persistTeams();

                closeModal();
            });

            closeBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);

            // Fecha clicando no overlay (fora do modal)
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) closeModal();
            });

            // Escape para fechar
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });

            // Ao clicar em Iniciar, persiste e navega para marcador.html
            if (startBtn) {
                startBtn.addEventListener('click', function () {
                    persistTeams();
                    // garante que o novo estado foi gravado antes da navega√ß√£o
                    setTimeout(() => {
                        window.location.href = 'marcador.html';
                    }, 50);
                });
            }
        })();
    </script>
</body>

</html>